#!/bin/bash
shopt -s nullglob

# get all attributes from imported libs in each .asm file
# and write them to a master list of attributes

ATTR_IN=$1/*.asm
ATTR_OUT=$2


TEMP1=$(mktemp)
TEMP2=$(mktemp)

for F in $ATTR_IN
do
    # write each .asm attribute list to the master list in $TEMP1
    cat $F >>$TEMP1
done

# sort master list | aggregrate by word frequency > write to output file
sort $TEMP1 | uniq -c >$TEMP2

# only use attributes that appear at least 20 times and are not a single digit (labels) | dedupe | remove 'stdcall' lines > write to final master attribute list
awk '$1 > 20 && length($2) > 1 {print $2}' $TEMP2 | sort | uniq | sed -n '/stdcall/!p' >$ATTR_OUT

rm $TEMP1
rm $TEMP2
exit 0


